--创建同义词
CREATE OR REPLACE SYNONYM table_owner.table_name FOR table_owner.table_name;


--------------------------------------------
--查看Oracle数据库中表空间信息的命令方法
select 
a.a1 表空间名称,
c.c2 类型,
c.c3 区管理,
b.b2/1024/1024 表空间大小M,
(b.b2-a.a2)/1024/1024 已使用M,
substr((b.b2-a.a2)/b.b2*100,1,5) 利用率
from 
(select  tablespace_name a1, sum(nvl(bytes,0)) a2 from dba_free_space group by tablespace_name) a,
(select tablespace_name b1,sum(bytes) b2 from dba_data_files group by tablespace_name) b,
(select tablespace_name c1,contents c2,extent_management c3  from dba_tablespaces) c 
where a.a1=b.b1 and c.c1=b.b1;

--检查运行过程中的耗时过多的sql
SELECT se.sid,se.serial#,pr.SPID,se.username,se.osuser,se.status,se.terminal,se.program,si.physical_reads,
 se.MODULE,se.sql_address,st.event,st.p1text,si.block_changes,sq.sql_text
  FROM v$session se, v$session_wait st,v$sess_io si,v$process pr,v$sqlarea sq
  WHERE sq.address=se.sql_address and st.sid=se.sid AND st.sid=si.sid AND se.PADDR=pr.ADDR AND se.sid>6 AND st.event NOT LIKE '%SQL%'      --AND st.wait_time=0 
  ORDER BY physical_reads DESC;

--查找表的所有字段
 SELECT MAX(SUBSTR(SYS_CONNECT_BY_PATH(COLUMN_NAME,','),2)) AS 所有字段
 FROM (SELECT COLUMN_NAME,column_id FROM dba_tab_columns
 WHERE OWNER = 'ZTE_USER' 
 AND TABLE_NAME = 'HN_CUST')
 START WITH column_id = 1 CONNECT BY column_id = ROWNUM;

--WMSYS.WM_CONCAT


--会话特有的临时表 
CREATE GLOBAL TEMPORARY <TABLE_NAME> (<column specification> ) 
ON COMMIT PRESERVE ROWS; 
--事务特有的临时表 
CREATE GLOBAL TEMPORARY <TABLE_NAME> (<column specification> ) 
ON COMMIT DELETE ROWS； 

--创建database_link
create public database link TO_DATA54
  connect to ZTE_USER IDENTIFIED BY ZTE_USER
  using '(DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 134.175.23.54)(PORT = 1521))
    )
    (CONNECT_DATA =
      (SID = crmtestdb)
    )
  )';

--表重命名
RENAME table_1 TO table_2;

--表分析
EXEC dbms_stats.gather_table_stats(ownname=>'ZTE_USER',tabname=>'HN_CUST',estimate_percent=>DBMS_STATS.AUTO_SAMPLE_SIZE,method_opt=>'for all columns size auto',degree=>DBMS_STATS.DEFAULT_DEGREE,cascade=>true); 

--回滚drop掉的表
select object_name,original_name,partition_name,type,ts_name,createtime,droptime from recyclebin  where original_name like '%IDENTI_BILL%' ;

flashback table "ORI_CUST_IDENTI_BILL_ADD" to before drop;


--恢复删掉的数据
select * from table_name as of timestamp to_timestamp('2011-04-29 19:00','YYYY-MM-DD HH24:MI'); 

/*1.FLASHBACK QUERY*/ 

--闪回到15分钟前 
select *  from orders  as of timestamp (systimestamp - interval '15' minute)  where ...... 
这里可以使用DAY、SECOND、MONTH替换minute，例如： 
SELECT * FROM orders AS OF TIMESTAMP(SYSTIMESTAMP - INTERVAL '2' DAY) 

--闪回到某个时间点 
select  *  from orders  as of timestamp  to_timestamp ('01-Sep-04 16:18:57.845993', 'DD-Mon-RR HH24:MI:SS.FF') where ... 

--闪回到两天前 
select * from orders  as of timestamp (sysdate - 2) where......... 


/*2.FLASHBACK DROP*/ 

  1.flashback table orders to before drop; 
  
  2.如果源表已经重建，可以使用rename to子句： 
  flashback table order to before drop  rename to order_old_version; 
  
/*3.FLASHBACK TABLE*/ 

  1.首先要启用行迁移： 
  alter table order enable row movement; 
  2.闪回表到15分钟前： 
  flashback table order  to timestamp systimestamp - interval '15' minute; 
    闪回到某个时间点： 
  FLASHBACK TABLE order TO TIMESTAMP    TO_TIMESTAMP('2007-09-12 01:15:25 PM','YYYY-MM-DD HH:MI:SS AM') 


--Lockwait：死锁的状态，如果有内容表示被死锁。
select username,lockwait,status,machine,program from v$session where sid in
(select session_id from v$locked_object)

--查看空间文件
SELECT * FROM dba_data_files;